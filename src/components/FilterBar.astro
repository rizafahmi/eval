---
import type { RubricType } from '../lib/types';

interface Props {
  fromDate?: string;
  toDate?: string;
  rubric?: RubricType | '';
  minScore?: number;
}

const { fromDate, toDate, rubric, minScore } = Astro.props;

// Get current params to preserve (excluding filter fields and pagination)
const currentParams = Astro.url.searchParams;
const excludedParams = ['fromDate', 'toDate', 'rubric', 'minScore', 'page', 'limit'];
const preservedParams: { key: string; value: string }[] = [];

currentParams.forEach((value, key) => {
  if (!excludedParams.includes(key)) {
    preservedParams.push({ key, value });
  }
});

const rubrics: { value: RubricType; label: string }[] = [
  { value: 'exact_match', label: 'Exact Match' },
  { value: 'partial_credit', label: 'Partial Credit' },
  { value: 'semantic_similarity', label: 'Semantic Similarity' },
];
---

<form method="get" class="card-luxe p-5 mb-8 animate-reveal delay-100">
  {preservedParams.map(param => (
    <input type="hidden" name={param.key} value={param.value} />
  ))}

  <div class="flex flex-wrap items-end gap-4">
    <div class="form-control">
      <label class="label">
        <span class="metric-label text-xs">From Date</span>
      </label>
      <input
        type="date"
        name="fromDate"
        value={fromDate}
        class="input input-bordered input-sm border-gold-light focus:border-luxe-gold transition-colors"
      />
    </div>

    <div class="form-control">
      <label class="label">
        <span class="metric-label text-xs">To Date</span>
      </label>
      <input
        type="date"
        name="toDate"
        value={toDate}
        class="input input-bordered input-sm border-gold-light focus:border-luxe-gold transition-colors"
      />
    </div>

    <div class="form-control">
      <label class="label">
        <span class="metric-label text-xs">Rubric</span>
      </label>
      <select name="rubric" class="select select-bordered select-sm border-gold-light focus:border-luxe-gold transition-colors">
        <option value="">All Rubrics</option>
        {rubrics.map(r => (
          <option value={r.value} selected={r.value === rubric}>{r.label}</option>
        ))}
      </select>
    </div>

    <div class="form-control w-28">
      <label class="label">
        <span class="metric-label text-xs">Min Score</span>
      </label>
      <input
        type="number"
        name="minScore"
        value={minScore}
        min="0"
        max="100"
        class="input input-bordered input-sm font-mono border-gold-light focus:border-luxe-gold transition-colors"
        placeholder="0-100"
      />
    </div>

    <div class="form-control pb-0.5">
      <button type="submit" class="btn btn-luxe btn-luxe-primary btn-sm font-semibold">
        Filter
      </button>
    </div>

    <div class="form-control pb-0.5">
      <a href={Astro.url.pathname + (preservedParams.length ? '?' + new URLSearchParams(preservedParams.map(p => [p.key, p.value])).toString() : '')} class="btn btn-ghost btn-sm">
        Reset
      </a>
    </div>
  </div>
</form>
