<div class="dropdown dropdown-end">
  <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
  </div>
  <ul tabindex="0" class="dropdown-content z-[1] p-2 shadow-2xl bg-base-300 rounded-box w-52">
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Light" value="light"/></li>
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Dark" value="dark"/></li>
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Cupcake" value="cupcake"/></li>
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Nord" value="nord"/></li>
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Luxury" value="luxury"/></li>
    <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Silk" value="silk"/></li>
  </ul>
</div>

<script>
  const prefsKey = "eval_user_prefs";

  const readPrefs = () => {
    try {
      return JSON.parse(localStorage.getItem(prefsKey) || "{}");
    } catch {
      return {};
    }
  };

  const writePrefs = (theme) => {
    const prefs = readPrefs();
    const nextPrefs = {
      ...prefs,
      theme,
    };
    localStorage.setItem(prefsKey, JSON.stringify(nextPrefs));
  };

  const themeRadios = document.querySelectorAll('input[name="theme-dropdown"]');
  const storedTheme = readPrefs()?.theme || localStorage.getItem("theme");
  const currentTheme =
    document.documentElement.getAttribute("data-theme") || storedTheme || "light";

  themeRadios.forEach((radio) => {
    if (!(radio instanceof HTMLInputElement)) return;
    radio.checked = radio.value === currentTheme;
    radio.addEventListener("change", (event) => {
      const target = event.target;
      if (!(target instanceof HTMLInputElement)) return;
      const newTheme = target.value;
      document.documentElement.setAttribute("data-theme", newTheme);
      writePrefs(newTheme);
      localStorage.setItem("theme", newTheme);
    });
  });
</script>
